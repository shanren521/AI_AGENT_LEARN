# 2 LangChain入门指南

## 2.1初识LangChain

### 2.1.3 LangChain的2个关键词

+ 组件：包括LLM模型包装器、聊天模型包装器与数据增强相关的工具和接口
+ 链: 将各种组件连接在一起的纽带,它能够确保组件之间的无缝集成和在程序运行环境中的高效调用

+ 链具体作用：当用户提出问题时, LangChain 提供的API允许机器人执行以下操作:
  + 请求LLM解释用户的输入，并根据输入内容生成对应的查询请求，可能涉及多个组件
  + 根据生成的查询请求，激活对应的组件以获取必要的数据或信息
  + 利用LLM生成基于自然语言的回答，将各组件的返回结果整合为用户可以理解的回答

### 2.1.4 LangChain的3个场景

+ 1、问答系统
+ 2、数据处理与管理，如RAG。RAG结合了检索和生成两个阶段，LangChain采用了LEDVR工作流实现了RAG功能，为了更好处理大量的数据，LangChain中引入了分块转化步骤
  + LEDVR工作流介绍
  + 文档加载器WebBaseLoader：从外部数据源导入需要的数据。确保数据的完整性和原始性
  + 嵌入包装器OpenAIEmbeddings：将文档转换为向量，能捕获文档的主要特征
  + 分块化RecursiveCharacterTextSplitter：为了更好的处理大量的数据，将文档切割成更小的数据，提高处理速度和精确度
  + 向量存储系统FAISS：存储处理完的数据， 确保数据的完全，提供高效的查询接口
  + 检索器ConversationalRetrievalChain：从向量存储系统中检索相关的文档
+ 3、自动问答与客服机器人，LangChain的Agent功能

### 2.1.5 LangChain的6大模块

+ 1、模型I/O：其功能是提供模型包装器，模型包装器的提示词功能使得开发者可以模块化、动态选择和管理模型输入
+ 2、数据增强：LangChain提供了加载、转换、存储和查询数据的构建块。其输出解析器能帮助开发者从模型输出中提取所需的信息
+ 3、链：复杂应用需要将多个LLM模型包装器或其他组件进行链式连接
+ 4、记忆memory：链首先从记忆模块中读取数据，然后在执行核心逻辑后将当前运行的输入和输出写入记忆模块。
+ 5、Agent：核心思想是利用LLM选择操作序列。
+ 6、回调处理器：允许开发者在LLM应用的各个阶段对状态进行干预。

## 2.2 LangChain的开发流程

  聊天机器人案例：包含大语言模型、LLM集成中间件(LangChain6大模块)、终端web页面
  chapter2.py  代码1

### 2.2.2 编写一个取名程序

+ `llm.predict("What would be a good company name for a company that makes colorful socks?")`

### 2.2.3 创建聊天机器人

  chapter2.py 聊天机器人

+ 提示词模版：特殊的文本，可以为特定任务提供额外的上下文信息，在LangChain中可以使用MessagePromptTemplete来创建提示词模版
  + chatper.py 提示词模版
+ 创建链
  + chapter.py 创建第一个链
+ Agent
  + 主要职责是基于输入的信息动态选择执行哪些动作，以及这些动作的执行顺序
  + 创建并加载一个Agent，需要选择几个要素
    + 聊天模型包装器：这是驱动Agent的LLM
    + 工具：执行特定任务的函数，如，谷歌搜索、数据库查询
    + 代理名称：一个字符，用于选择具体的Agent类
    + chapter2.py SerpAPI Agent
+ 记忆组件
  + 用于维护应用程序的状态
  + 两个基本操作：读取和写入，在执行核心逻辑之前，系统会从记忆组件中读取信息以增强用户输入。执行核心逻辑之后，返回答案之前，系统会将当前运行的输入和输出写入记忆组件
  + chapter2.py 记忆组件

## 2.3 LangChain 表达式

  通过使用管道操作符"|"，可以实现各个组件链的组合, chatper2.py 管道符
  
+ 提示词模板+模型包装器
  + chapter2.py 提示词模板+模型包装器
+ 提示词模板+模型包装器+输出解析器
  + chapter2.py 提示词模板+模型包装器+输出解析器
+ 多功能组合链
  + chapter2.py 多功能组合链

# 3 模型I/O

## 3.1 什么事模型I/O

+ 目标是开发者无需深入理解各个模型平台的API调用协议就可以方便地与各种大语言模型平台进行交互，是对各个大语言模型平台API的封装

## 3.2 模型I/O功能之模型包装器

### 3.2.1 模型包装器分类

  分为两类：通用的LLM模型包装器、专门针对Chat类型API的Chat Model 聊天模型包装器
  LLM模型包装器获得的响应是字符串，聊天模型包装器是接受一系列的消息作为输入，并返回一个消息类型作为输出，获得的响应是AIMessage消息数据
  LLM模型包装器是一种专门用于与大语言模型文本补全类型API交互的组件
  openai = OpenAI(model_name="text-davinci-003")

+ 1、输入的区别
  + LLM模型包装器：输入通常是单一的字符串提示词prompt，LLM模型包装器主要用于文本任务
  + 聊天模型包装器：输入则是聊天消息。每条消息都有role、content，返回内容包含在AIMessage
+ 2、输出的区别
  + 


